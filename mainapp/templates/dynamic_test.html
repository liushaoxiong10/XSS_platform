<!DOCTYPE html>
<html>
{% load staticfiles %}
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>Dynamic Test |XSS 漏洞检测</title>
    <!-- Favicon-->
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">


    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&subset=latin,cyrillic-ext" rel="stylesheet"
          type="text/css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" type="text/css">

    <!-- Bootstrap Core Css -->
    <link href="{% static 'plugins/bootstrap/css/bootstrap.css' %} " rel="stylesheet">

    <!-- Waves Effect Css -->
    <link href="{% static 'plugins/node-waves/waves.css' %}" rel="stylesheet"/>

    <!-- Animation Css -->
    <link href="{% static 'plugins/animate-css/animate.css' %}" rel="stylesheet"/>
    <!-- Bootstrap Select Css -->
    <link href="{% static 'plugins/bootstrap-select/css/bootstrap-select.css' %}" rel="stylesheet"/>

    <!-- Bootstrap Spinner Css -->
    <link href="{% static 'plugins/jquery-spinner/css/bootstrap-spinner.css' %}" rel="stylesheet">

    <!-- Custom Css -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">

    <!-- AdminBSB Themes. You can choose a theme from css/themes instead of get all themes -->
    <link href="{% static 'css/themes/all-themes.css' %}" rel="stylesheet"/>
</head>

<body class="theme-red">

<!-- Page Loader -->
<div class="page-loader-wrapper">
    <div class="loader">
        <div class="preloader">
            <div class="spinner-layer pl-red">
                <div class="circle-clipper left">
                    <div class="circle"></div>
                </div>
                <div class="circle-clipper right">
                    <div class="circle"></div>
                </div>
            </div>
        </div>
        <p>Please wait...</p>
    </div>
</div>
<!-- #END# Page Loader -->
<!-- Overlay For Sidebars -->
<div class="overlay"></div>
<!-- #END# Overlay For Sidebars -->
<!-- Top Bar -->
<nav class="navbar">  <!--top-->
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="javascript:void(0);" class="navbar-toggle collapsed" data-toggle="collapse"
               data-target="#navbar-collapse" aria-expanded="false"></a>
            <a href="javascript:void(0);" class="bars" style="display: none;"></a>
            <a class="navbar-brand" href="/"> XSS 检测框架 </a>
        </div>
        <div class="collapse navbar-collapse" id="navbar-collapse">
            <ul class="nav navbar-nav navbar-right">


                <li class="pull-right"><a href="javascript:void(0);" class="js-right-sidebar" data-close="true"><i
                        class="material-icons">more_vert</i></a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- #Top Bar -->

<section>
    <!-- Left Sidebar -->
    <aside id="leftsidebar" class="sidebar">
        <!-- User Info -->
        <div class="user-info">
            <div class="image">
                <img src="{% static 'images/user.png' %}" width="48" height="48" alt="User"/>
            </div>
            <div class="info-container">
                <div class="name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">K0ala</div>
                <div class="email">liushaoxiong10@outlook.com</div>

            </div>
        </div>
        <!-- #User Info -->
        <!-- Menu -->
        <div class="menu">
            <ul class="list">
                <li class="header">MAIN NAVIGATION</li>
                <li>
                    <a href="/">
                        <i class="material-icons">home</i>
                        <span>Home</span>
                    </a>
                </li>

                <li>
                    <a href="/pages/static">
                        <i class="material-icons">folder</i>
                        <span>Static Test</span>
                    </a>
                </li>
                <li class="active">
                    <a href="/pages/dynamic">
                        <i class="material-icons">compare_arrows</i>
                        <span>Dynamic Test</span>
                    </a>
                </li>
                <li>
                    <a href="/pages/history">
                        <i class="material-icons">history</i>
                        <span>History</span>
                    </a>
                </li>

            </ul>
        </div>
        <!-- #Menu -->
        <!-- Footer -->
        <div class="legal">
            <div class="copyright">
                &copy; 2017-2018 <a href="javascript:void(0);">Power By K0ala</a>.
            </div>
            <div class="version">
                <b>Version: </b> 1.0.0
            </div>
        </div>
        <!-- #Footer -->
    </aside>
    <!-- #END# Left Sidebar -->
    <!-- Right Sidebar -->
    <aside id="rightsidebar" class="right-sidebar">
        <ul class="nav nav-tabs tab-nav-right" role="tablist">
            <li role="presentation" class="active"><a href="#skins" data-toggle="tab">SKINS</a></li>
        </ul>
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active in active" id="skins">
                <ul class="demo-choose-skin">
                    <li data-theme="red" class="active">
                        <div class="red"></div>
                        <span>Red</span>
                    </li>
                    <li data-theme="pink">
                        <div class="pink"></div>
                        <span>Pink</span>
                    </li>
                    <li data-theme="purple">
                        <div class="purple"></div>
                        <span>Purple</span>
                    </li>
                    <li data-theme="deep-purple">
                        <div class="deep-purple"></div>
                        <span>Deep Purple</span>
                    </li>
                    <li data-theme="indigo">
                        <div class="indigo"></div>
                        <span>Indigo</span>
                    </li>
                    <li data-theme="blue">
                        <div class="blue"></div>
                        <span>Blue</span>
                    </li>
                    <li data-theme="light-blue">
                        <div class="light-blue"></div>
                        <span>Light Blue</span>
                    </li>
                    <li data-theme="cyan">
                        <div class="cyan"></div>
                        <span>Cyan</span>
                    </li>
                    <li data-theme="teal">
                        <div class="teal"></div>
                        <span>Teal</span>
                    </li>
                    <li data-theme="green">
                        <div class="green"></div>
                        <span>Green</span>
                    </li>
                    <li data-theme="light-green">
                        <div class="light-green"></div>
                        <span>Light Green</span>
                    </li>
                    <li data-theme="lime">
                        <div class="lime"></div>
                        <span>Lime</span>
                    </li>
                    <li data-theme="yellow">
                        <div class="yellow"></div>
                        <span>Yellow</span>
                    </li>
                    <li data-theme="amber">
                        <div class="amber"></div>
                        <span>Amber</span>
                    </li>
                    <li data-theme="orange">
                        <div class="orange"></div>
                        <span>Orange</span>
                    </li>
                    <li data-theme="deep-orange">
                        <div class="deep-orange"></div>
                        <span>Deep Orange</span>
                    </li>
                    <li data-theme="brown">
                        <div class="brown"></div>
                        <span>Brown</span>
                    </li>
                    <li data-theme="grey">
                        <div class="grey"></div>
                        <span>Grey</span>
                    </li>
                    <li data-theme="blue-grey">
                        <div class="blue-grey"></div>
                        <span>Blue Grey</span>
                    </li>
                    <li data-theme="black">
                        <div class="black"></div>
                        <span>Black</span>
                    </li>
                </ul>
            </div>

        </div>
    </aside>
    <!-- #END# Right Sidebar -->
</section>

<section class="content">
    <div class="container-fluid">

        <!-- Input -->
        <div class="row clearfix">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="card">
                    <div class="header">
                        <h2>
                            Dynamic Test
                        </h2>
                    </div>
                    <div class="body">
                        <h2 class="card-inside-title">Input Url Information</h2>
                        <form class="form-horizontal">
                            {% csrf_token %}

                            <!--input ip-->
                            <div class="row clearfix">
                                <div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
                                    <label for="url_address">URL (or IP)</label>
                                </div>
                                <div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
                                    <div class="form-group">
                                        <div class="form-line">
                                            <input type="text" id="url_address" class="form-control"
                                                   placeholder="URL or IP (eg:http://www.google.com)"
                                                   onkeyup="checkURL(this.value,this.id)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Post-->
                            <div class="row clearfix">
                                <div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
                                    <input type="checkbox" id="check_post" class="filled-in chk-col-green"
                                           onclick="change_info('postdata');change_input(this,'postdata')"/>
                                    <label for="check_post">POST</label></div>
                                <div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
                                    <div class="form-group">
                                        <div class="form-line disabled">
                                            <input type="text" class="form-control" id="postdata"
                                                   placeholder="POST DATA" disabled/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--cookie-->
                            <div class="row clearfix">
                                <div class="col-lg-2 col-md-2 col-sm-4 col-xs-5 form-control-label">
                                    <input type="checkbox" id="check_cookies" class="filled-in chk-col-green"
                                           onclick="change_input(this,'cookies')"/>
                                    <label for="check_cookies">Cookies</label></div>
                                <div class="col-lg-10 col-md-10 col-sm-8 col-xs-7">
                                    <div class="form-group">
                                        <div class="form-line disabled">
                                            <input type="text" class="form-control" id="cookies"
                                                   placeholder="Cookies('a=a;b=b')" disabled/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--ParamFinder-->
                            <div class="row clearfix">
                                <div class="col-lg-offset-1 col-md-offset-1 col-sm-offset-3 col-xs-offset-4">
                                    <input type="checkbox" id="check_param" class="filled-in chk-col-green"
                                           onclick="(function (val) {
                                              if (null == val.getAttribute('checked')) {
                                                  val.setAttribute('checked','');
                                              } else {
                                                  val.removeAttribute('checked');
                                              }
                                    }(this))"/>
                                    <label for="check_param">Param Finder</label></div>
                            </div>

                            <!--WAF delayed-->
                            <div class="row clearfix">
                                <div class="col-lg-4 col-md-4 col-sm-5 col-xs-6 form-control-label">
                                    <label>If target has WAF,Will be delay</label>
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-5 col-xs-4">
                                    <div class="input-group spinner" data-trigger="spinner">
                                        <div class="form-line">
                                            <input type="text" class="form-control text-center" value="6" id="waf_delay"
                                                   data-rule="quantity">
                                        </div>
                                        <span class="input-group-addon">
                                            <a href="javascript:;" class="spin-up" data-spin="up"><i
                                                    class="glyphicon glyphicon-chevron-up"></i></a>
                                            <a href="javascript:;" class="spin-down" data-spin="down"><i
                                                    class="glyphicon glyphicon-chevron-down"></i></a>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-lg-1 col-md-1 col-sm-1 col-xs-2 form-control-label">
                                    <label>Second</label>
                                </div>

                            </div>


                            <!--submit-->
                            <div class="row clearfix">
                                <div class="col-lg-offset-2 col-md-offset-2 col-sm-offset-4 col-xs-offset-5">
                                    <button type="button" class="btn btn-primary m-t-15 waves-effect"
                                            onclick="submit_info()">submit
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- #END# Input -->
    </div>
</section>

<!-- Jquery Core Js -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>

<!-- Bootstrap Core Js -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.js' %}"></script>

<!-- Select Plugin Js -->
<script src="{% static 'plugins/bootstrap-select/js/bootstrap-select.js' %}"></script>

<!-- Slimscroll Plugin Js -->
<script src="{% static 'plugins/jquery-slimscroll/jquery.slimscroll.js' %}"></script>

<!-- Waves Effect Plugin Js -->
<script src="{% static 'plugins/node-waves/waves.js' %}"></script>

<!-- Bootstrap Notify Plugin Js -->
<script src="{% static 'plugins/bootstrap-notify/bootstrap-notify.js' %}"></script>

<!-- Custom Js -->
<script src="{% static 'js/admin.js' %}"></script>

<!-- Jquery Spinner Plugin Js -->
<script src="{% static 'plugins/jquery-spinner/js/jquery.spinner.js' %}"></script>


<!-- Demo Js -->
<script src="{% static 'js/demo.js' %}"></script>

<script>

    //检测url合法性
    function checkURL(value, id) {
        var strRegex = "^((https|http|)?://)"
            + "(([0-9]{1,3}\.){3}[0-9]{1,3}" // IP形式的URL- 199.194.52.184
            + "|" // 允许IP和DOMAIN（域名）
            + "([0-9a-z_!~*'()-]+\.)*" // 域名- www.
            + "([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\." // 二级域名
            + "[a-z]{2,6})" // first level domain- .com or .museum
            + "(:[0-9]{1,4})?" // 端口- :80
            + "((/?)|" // a slash isn't required if there is no file name
            + "(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";
        var re = new RegExp(strRegex);
        var parent = document.getElementById(id).parentNode;
        var url = value.split("?")[0]

        if (re.test(url)) {
            parent.className = "form-line focused success";

        } else {
            parent.className = "form-line focused error";
        }


    }

    //更改post，cookie输入框的可输入性
    function change_input(val, change_id) {
        var i = document.getElementById(change_id);
        if (null == val.getAttribute("checked")) {
            val.setAttribute("checked", "");

            if (null != i.getAttribute("disabled")) {
                i.removeAttribute("disabled");
            }
        } else {
            val.removeAttribute("checked");
            i.setAttribute("disabled", "");

        }

    }

    //弹出提示框
    function change_info(change_id) {

        var placementFrom = "top";
        var placementAlign = "center";
        var animateEnter = "animated fadeInDown";
        var animateExit = "animated fadeOutUp";
        var colorName = "alert-info";
        var allowDismiss = true;
        var i = document.getElementById(change_id);
        if (null != i.getAttribute("disabled")) {
            var text = "The POST method is about to be used!<br>" +
                "And the GET method Will be ignored!";
        } else {
            var text = "The GET method is about to be used!<br>" +
                "And POST Data will be disable!";
        }

        $.notify({
                message: text
            },
            {
                type: colorName,
                allow_dismiss: allowDismiss,
                newest_on_top: true,
                timer: 1000,
                placement: {
                    from: placementFrom,
                    align: placementAlign
                },
                animate: {
                    enter: animateEnter,
                    exit: animateExit
                },
                template: '<div data-notify="container" class="bootstrap-notify-container alert alert-dismissible {0} ' + (allowDismiss ? "p-r-35" : "") + '" role="alert">' +
                '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>' +
                '<span data-notify="icon"></span> ' +
                '<span data-notify="title">{1}</span> ' +
                '<span data-notify="message">{2}</span>' +
                '<div class="progress" data-notify="progressbar">' +
                '<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>' +
                '</div>' +
                '<a href="{3}" target="{4}" data-notify="url"></a>' +
                '</div>'
            });

    }

    //递交数据
    function submit_info() {

        var urlElem = document.getElementById("url_address");
        if (urlElem.parentNode.getAttribute("class").indexOf("error") > 0) {

            alert("URL Error");
            return;
        }

        var url, Data = "", method, cookies = "", param, attack;
        var postElem = document.getElementById("postdata");

        if (document.getElementById("check_param").getAttribute("checked") != null) {
            param = "True";
        } else {
            param = "False";
        }

        if (postElem.getAttribute("disabled") == null) {
            if (postElem.value === "") {
                alert("Please Input POST DATA");
                return;
            }
            url = urlElem.value;
            Data = postElem.value;
            method = "POST";
        } else {
            var tem = urlElem.value.split("?");
            if (tem.length === 1) {
                url = tem[0];
                Data = "";
                param = "True";
            } else {
                url = tem[0];
                Data = tem[1];
            }
            method = "GET";
        }
        var cookieElem = document.getElementById("cookies");
        if (cookieElem.getAttribute("disabled") == null) {
            if (cookieElem.value === "") {
                alert("Please Input Cookies");
                return;
            }
            cookies = cookieElem.value;
        }

        var delay = document.getElementById("waf_delay").value;

        $.post('/pages/dynamic', {
                "url": url,
                "method": method,
                "args": Data,
                "cookies": cookies,
                "param": param,
                "delay": delay,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            function (data) {
                if (data === "success") {
                    alert("The URL information is filled successfully.");
                    location.reload();
                } else {
                    alert("Please refill !");
                }
            })

    }

</script>

</body>

</html>
